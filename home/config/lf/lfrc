# todo duplicate switch statements

cmd open ${{
	case $(file --mime-type -Lb "$f") in
                inode/x-empty)
                    nvim $fx
                    ;;
 		text/*) 
		    nvim $fx
		    ;;
		image/*)
		    imv "$fx" > /dev/null 2>&1 &
		    ;;
                video/*) 
                    mpv --keep-open=yes "$fx" > /dev/null 2>&1 &
                    ;;
                audio/*)
                    mpv --keep-open=yes --force-window=yes "$fx" > /dev/null 2>&1 &
                    ;;
		application/pdf)
#https://unix.stackexchange.com/questions/3886/difference-between-nohup-disown-and
#maybe use &! or disown?
                # nohup so zathura is not closed when the terminal closes
                # i might want to use this for other things as well
		    nohup zathura "$fx" > /dev/null 2>&1 &
		    ;;
		application/gzip)
		    xournalpp "$fx" > /dev/null 2>&1 &
		    ;;
                application/msword) 
                    libreoffice "$fx" > /dev/null 2>&1 &
                    ;;
                application/vnd.*)
                    libreoffice "$fx" > /dev/null 2>&1 &
                    ;;
		*) 
		    for f in $fx; do
			echo $f $(file --mime-type -Lb $f)| less;
			# xdg-open $f > /dev/null 2> /dev/null &
		    done
		    ;;
	esac
}}

# show current directory in window title
cmd on-cd &{{
    # '&' commands run silently in background (which is what we want here),
    # but are not connected to stdout.
    # To make sure our escape sequence still reaches stdout we pipe it to /dev/tty
    printf "\033]0;$PWD\007" > /dev/tty
}}

# also run at startup
on-cd

# ctpv previews
set previewer ctpv
set cleaner ctpvclear
&ctpv -s $id
&ctpvquit $id
