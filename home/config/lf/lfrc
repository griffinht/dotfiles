# todo duplicate switch statements

cmd open ${{
	case $(file --mime-type -Lb "$f") in
                inode/x-empty)
                    nvim $fx
                    ;;
 		text/*) 
		    nvim $fx
		    ;;
		image/*)
		    imv "$fx" > /dev/null 2>&1 &
		    ;;
                video/*) 
                    mpv "$fx" > /dev/null 2>&1 &
                    ;;
                audio/*)
                    mpv "$fx" > /dev/null 2>&1 &
                    ;;
		application/pdf)
#https://unix.stackexchange.com/questions/3886/difference-between-nohup-disown-and
#maybe use &! or disown?
                # nohup so zathura is not closed when the terminal closes
                # i might want to use this for other things as well
		    nohup zathura "$fx" > /dev/null 2>&1 &
		    ;;
		application/gzip)
		    xournalpp "$fx" > /dev/null 2>&1 &
		    ;;
                application/msword) 
                    libreoffice "$fx" > /dev/null 2>&1 &
                    ;;
                application/vnd.*)
                    libreoffice "$fx" > /dev/null 2>&1 &
                    ;;
		*) 
		    for f in $fx; do
			echo $f $(file --mime-type -Lb $f)| less;
			# xdg-open $f > /dev/null 2> /dev/null &
		    done
		    ;;
	esac
}}

# show current directory in window title
cmd on-cd &{{
    # '&' commands run silently in background (which is what we want here),
    # but are not connected to stdout.
    # To make sure our escape sequence still reaches stdout we pipe it to /dev/tty
    printf "\033]0;$PWD\007" > /dev/tty
}}

# also run at startup
on-cd

# ctpv previews
set previewer ctpv
set cleaner ctpvclear
&ctpv -s $id
&ctpvquit $id


cmd fzf_search ${{
    lf -remote "send $id select $( \
        RG_PREFIX="rg --color=always --smart-case --column --line-number --heading --context=5"
        FZF_DEFAULT_COMMAND="$RG_PREFIX ''" \
            fzf \
            --disabled --ansi \
            --bind "change:reload:$RG_PREFIX {q} || true" \
            | cut -d ':' -f 1
        )"

#--layout-reverse?
#--header 'header'?
    #--delimiter ':' --preview 'bat --color=always {1} --highlight-line={2}' \
}}
map gs :fzf_search
#https://github.com/gokcehan/lf/wiki/Integrations#fzf

# alt-enter to launch in new window
cmd fzf_find ${{
     lf -remote "send $id select $( \
         fzf --preview-window=up --preview="ctpv "{}"" \
            --bind="alt-enter:execute(swaymsg -t command exec \\\$term lf $(pwd)/{})+abort" \
         )"
         # I HATE SHELL ESCAPING
         # I HATE SHELL ESCAPING
         # I HATE SHELL ESCAPING
 # todo files with spaces dont work somehow bruh
# todo use "become" once fzf updates
# this way fzf isnt left hanging around
# not that it really does but whatever
}}
map f :fzf_find

